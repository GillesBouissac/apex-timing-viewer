import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{s as ne,o as ie}from"../chunks/CnKsjyTb.js";import{s as R,h as E,a7 as le,f as J,c as oe,b as fe,w as N,B as ue,r as ce,H as ve,d as W,e as $,m as P,a8 as pe,ac as de,i as k,k as me,j as he,ag as Z,aq as _e,aA as G,aB as X,aC as ge,l as Q,p as ye,aD as Ne,aE as O,aF as j,aG as we,aH as Te,aa as Le,aI as be,af as xe,aJ as Ae,G as Ie,T as V,a0 as Y,X as K,$ as H,Z as C,aK as Ee,a4 as ee,_ as De,q,a3 as Fe,aL as Me,a5 as Pe,D as z}from"../chunks/Dg7XerDF.js";import{i as Ce}from"../chunks/epf7fQTu.js";import{i as Se}from"../chunks/COtTLUEp.js";import{s as S}from"../chunks/B0GOjEds.js";import{p as He}from"../chunks/BJDKmjST.js";import"../chunks/F35tNSu8.js";function Re(t,e){return e}function $e(t,e,a){for(var i=t.items,s=[],l=e.length,r=0;r<l;r++)be(e[r].e,s,!0);var p=l>0&&s.length===0&&a!==null;if(p){var g=a.parentNode;xe(g),g.append(a),i.clear(),b(t,e[0].prev,e[l-1].next)}Ae(s,()=>{for(var u=0;u<l;u++){var d=e[u];p||(i.delete(d.k),b(t,d.prev,d.next)),j(d.e,!p)}})}function Oe(t,e,a,i,s,l=null){var r=t,p={flags:e,items:new Map,first:null};{var g=t;r=E?R(le(g)):g.appendChild(J())}E&&oe();var u=null,d=!1,h=new Map,n=ue(()=>{var v=a();return _e(v)?v:v==null?[]:Z(v)}),o,f;function c(){qe(f,o,p,h,r,s,e,i,a),l!==null&&(o.length===0?u?Q(u):u=k(()=>l(r)):u!==null&&ye(u,()=>{u=null}))}fe(()=>{f??=Ie,o=N(n);var v=o.length;if(d&&v===0)return;d=v===0;let A=!1;if(E){var T=ce(r)===ve;T!==(v===0)&&(r=W(),R(r),$(!1),A=!0)}if(E){for(var m=null,y,_=0;_<v;_++){if(P.nodeType===pe&&P.data===de){r=P,A=!0,$(!1);break}var x=o[_],L=i(x,_);y=U(P,p,m,null,x,L,_,s,e,a),p.items.set(L,y),m=y}v>0&&R(W())}if(E)v===0&&l&&(u=k(()=>l(r)));else if(me()){var I=new Set,w=he;for(_=0;_<v;_+=1){x=o[_],L=i(x,_);var D=p.items.get(L)??h.get(L);D?ae(D,x,_):(y=U(null,p,null,null,x,L,_,s,e,a,!0),h.set(L,y)),I.add(L)}for(const[F,M]of p.items)I.has(F)||w.skipped_effects.add(M.e);w.add_callback(c)}else c();A&&$(!0),N(n)}),E&&(r=P)}function qe(t,e,a,i,s,l,r,p,g){var u=e.length,d=a.items,h=a.first,n=h,o,f=null,c=[],v=[],A,T,m,y;for(y=0;y<u;y+=1){if(A=e[y],T=p(A,y),m=d.get(T),m===void 0){var _=i.get(T);if(_!==void 0){i.delete(T),d.set(T,_);var x=f?f.next:n;b(a,f,_),b(a,_,x),B(_,x,s),f=_}else{var L=n?n.e.nodes_start:s;f=U(L,a,f,f===null?a.first:f.next,A,T,y,l,r,g)}d.set(T,f),c=[],v=[],n=f.next;continue}if(ae(m,A,y),(m.e.f&O)!==0&&Q(m.e),m!==n){if(o!==void 0&&o.has(m)){if(c.length<v.length){var I=v[0],w;f=I.prev;var D=c[0],F=c[c.length-1];for(w=0;w<c.length;w+=1)B(c[w],I,s);for(w=0;w<v.length;w+=1)o.delete(v[w]);b(a,D.prev,F.next),b(a,f,D),b(a,F,I),n=I,f=F,y-=1,c=[],v=[]}else o.delete(m),B(m,n,s),b(a,m.prev,m.next),b(a,m,f===null?a.first:f.next),b(a,f,m),f=m;continue}for(c=[],v=[];n!==null&&n.k!==T;)(n.e.f&O)===0&&(o??=new Set).add(n),v.push(n),n=n.next;if(n===null)continue;m=n}c.push(m),f=m,n=m.next}if(n!==null||o!==void 0){for(var M=o===void 0?[]:Z(o);n!==null;)(n.e.f&O)===0&&M.push(n),n=n.next;var te=M.length;if(te>0){var re=u===0?s:null;$e(a,M,re)}}t.first=a.first&&a.first.e,t.last=f&&f.e;for(var se of i.values())j(se.e);i.clear()}function ae(t,e,a,i){ge(t.v,e),t.i=a}function U(t,e,a,i,s,l,r,p,g,u,d){var h=(g&we)!==0,n=(g&Te)===0,o=h?n?G(s,!1,!1):X(s):s,f=(g&Ne)===0?r:X(r),c={i:f,v:o,k:l,a:null,e:null,prev:a,next:i};try{if(t===null){var v=document.createDocumentFragment();v.append(t=J())}return c.e=k(()=>p(t,o,f,u),E),c.e.prev=a&&a.e,c.e.next=i&&i.e,a===null?d||(e.first=c):(a.next=c,a.e.next=c.e),i!==null&&(i.prev=c,i.e.prev=c.e),c}finally{}}function B(t,e,a){for(var i=t.next?t.next.e.nodes_start:a,s=e?e.e.nodes_start:a,l=t.e.nodes_start;l!==null&&l!==i;){var r=Le(l);s.before(l),l=r}}function b(t,e,a){e===null?t.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}const Be="./data/laps";function ke(t){const e=t.match(/^D(\d+)\.L(\d+)#\|\|\|([bgp]?)(\d+)$/i);if(console.log(`(${t})`),console.log(e),e){const a=e[1],i=e[2],s=e[3]||void 0,l=e[4];return{type:"L",teamId:a,lapNum:i,lapType:s,lapTime:l,flags:{pitStop:s==="b",bestTeamLap:s==="g",bestGlobalLap:s==="p"}}}return{type:"L",raw:t}}function Ge(t){const e=t.match(/^D(\d+)\.P(\d+)#(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)$/);return e?{type:"P",teamId:e[1],lineNum:e[2],pitNum:e[3],lapNum:e[4],raceTimeBefore:e[5],raceTimeAfter:e[6],pitDuration:e[7],driverDuration:e[8],nbLapSinceLast:e[9],idDriver:e[10],totalDriverDuration:e[11]}:{type:"P",raw:t}}function Ke(t){const e=t.match(/^D(\d+)\.INF#(.*)$/s);if(!e)return{type:"INF",raw:t};const a=e[1],i=e[2].trim();try{const r=new DOMParser().parseFromString(i,"application/xml").querySelector("driver"),p=r?.getAttribute("name")??"",g=r?.querySelector("inf")?.getAttribute("value")??"",u=Array.from(r?.querySelectorAll(":scope > driver")??[]).map(d=>({id:d.getAttribute("id")??"",name:d.getAttribute("name")??""}));return{type:"INF",teamId:a,teamName:p,category:g,pilots:u}}catch{return{type:"INF",teamId:a,raw:i}}}async function Ue(t){const e=`${Be}/${t}`,a=await fetch(e);if(!a.ok)throw new Error("Fichier non trouvé");return(await a.text()).split(`
`).filter(s=>s.trim().length>0).map(s=>{const l=s.match(/^D\d+\.(L|P|INF)/),r=l?l[1]:"UNKNOWN";return r==="L"?ke(s):r==="P"?Ge(s):r==="INF"?Ke(s):{type:"UNKNOWN",raw:s}})}const Ve="./data/laps",We=`${Ve}/laps_files.json`;async function Xe(){const t=await fetch(We);if(!t.ok)throw new Error("Fichier laps_files.json non trouvé");return await t.json()}var Ye=Ee('<circle r="4" class="svelte-1vrm2o4"></circle><text y="115" font-size="10" text-anchor="middle"> </text>',1),ze=V('<div class="bg-white rounded shadow p-4 svelte-1vrm2o4"><h3 class="font-bold mb-2">Chronos des tours</h3> <svg width="100%" height="120" viewBox="0 0 4000 120"></svg></div>');function Je(t,e){let a=He(e,"laps",24,()=>[]);var i=ze(),s=Y(K(i),2);Oe(s,5,a,Re,(l,r,p)=>{var g=Ye(),u=ee(g);S(u,"cx",20+p*30);var d=Y(u);S(d,"x",20+p*30);var h=K(d,!0);H(d),De(n=>{S(u,"cy",n),S(u,"fill",(N(r),q(()=>N(r).lapType==="g"?"#38bdf8":N(r).lapType==="p"?"#f59e42":N(r).lapType==="b"?"#ef4444":"#888"))),ne(h,(N(r),q(()=>N(r).lapNum)))},[()=>(N(r),q(()=>100-Math.min(+N(r).lapTime/1e3,90)))]),C(l,g)}),H(s),H(i),C(t,i)}var Ze=V("<div>Chargement…</div>"),Qe=V('<div class="grid md:grid-cols-2 gap-4"><!></div>');function oa(t,e){Fe(e,!1);let a=G([]),i=[],s=G(!0);async function l(){i=await Xe(),i.length>0&&await r(i[0]),z(s,!1)}async function r(h){const n=await Ue(h);z(a,n.filter(o=>o.type==="L").map(o=>({lapNum:o.lapNum,lapTime:o.lapTime,lapType:o.lapType})).sort((o,f)=>Number(o.lapNum)-Number(f.lapNum))),console.log(h,N(a))}ie(l),Se();var p=Me(),g=ee(p);{var u=h=>{var n=Ze();C(h,n)},d=h=>{var n=Qe(),o=K(n);Je(o,{get laps(){return N(a)}}),H(n),C(h,n)};Ce(g,h=>{N(s)?h(u):h(d,!1)})}C(t,p),Pe()}export{oa as component};
