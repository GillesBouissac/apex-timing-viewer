import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{s as ne,o as ie}from"../chunks/CnKsjyTb.js";import{s as P,h as D,a7 as le,f as J,c as fe,b as oe,w as N,B as ue,r as ce,H as ve,d as W,e as q,m as C,a8 as de,ac as pe,i as G,k as me,j as he,ag as Z,aq as _e,aA as K,aB as X,aC as ge,l as Q,p as ye,aD as Ne,aE as R,aF as j,aG as we,aH as Te,aa as be,aI as xe,af as Ie,aJ as Le,G as Ee,T as V,a0 as Y,X as U,$ as O,Z as S,aK as De,a4 as ee,_ as Ae,q as B,a3 as Me,aL as Fe,a5 as Ce,D as z}from"../chunks/Dg7XerDF.js";import{i as Se}from"../chunks/epf7fQTu.js";import{i as He}from"../chunks/COtTLUEp.js";import{s as H}from"../chunks/B0GOjEds.js";import{p as Oe}from"../chunks/BJDKmjST.js";function Pe(t,e){return e}function qe(t,e,a){for(var r=t.items,i=[],l=e.length,n=0;n<l;n++)xe(e[n].e,i,!0);var d=l>0&&i.length===0&&a!==null;if(d){var g=a.parentNode;Ie(g),g.append(a),r.clear(),x(t,e[0].prev,e[l-1].next)}Le(i,()=>{for(var u=0;u<l;u++){var p=e[u];d||(r.delete(p.k),x(t,p.prev,p.next)),j(p.e,!d)}})}function Re(t,e,a,r,i,l=null){var n=t,d={flags:e,items:new Map,first:null};{var g=t;n=D?P(le(g)):g.appendChild(J())}D&&fe();var u=null,p=!1,h=new Map,s=ue(()=>{var v=a();return _e(v)?v:v==null?[]:Z(v)}),f,o;function c(){Be(o,f,d,h,n,i,e,r,a),l!==null&&(f.length===0?u?Q(u):u=G(()=>l(n)):u!==null&&ye(u,()=>{u=null}))}oe(()=>{o??=Ee,f=N(s);var v=f.length;if(p&&v===0)return;p=v===0;let L=!1;if(D){var T=ce(n)===ve;T!==(v===0)&&(n=W(),P(n),q(!1),L=!0)}if(D){for(var m=null,y,_=0;_<v;_++){if(C.nodeType===de&&C.data===pe){n=C,L=!0,q(!1);break}var I=f[_],b=r(I,_);y=k(C,d,m,null,I,b,_,i,e,a),d.items.set(b,y),m=y}v>0&&P(W())}if(D)v===0&&l&&(u=G(()=>l(n)));else if(me()){var E=new Set,w=he;for(_=0;_<v;_+=1){I=f[_],b=r(I,_);var A=d.items.get(b)??h.get(b);A?ae(A,I,_):(y=k(null,d,null,null,I,b,_,i,e,a,!0),h.set(b,y)),E.add(b)}for(const[M,F]of d.items)E.has(M)||w.skipped_effects.add(F.e);w.add_callback(c)}else c();L&&q(!0),N(s)}),D&&(n=C)}function Be(t,e,a,r,i,l,n,d,g){var u=e.length,p=a.items,h=a.first,s=h,f,o=null,c=[],v=[],L,T,m,y;for(y=0;y<u;y+=1){if(L=e[y],T=d(L,y),m=p.get(T),m===void 0){var _=r.get(T);if(_!==void 0){r.delete(T),p.set(T,_);var I=o?o.next:s;x(a,o,_),x(a,_,I),$(_,I,i),o=_}else{var b=s?s.e.nodes_start:i;o=k(b,a,o,o===null?a.first:o.next,L,T,y,l,n,g)}p.set(T,o),c=[],v=[],s=o.next;continue}if(ae(m,L,y),(m.e.f&R)!==0&&Q(m.e),m!==s){if(f!==void 0&&f.has(m)){if(c.length<v.length){var E=v[0],w;o=E.prev;var A=c[0],M=c[c.length-1];for(w=0;w<c.length;w+=1)$(c[w],E,i);for(w=0;w<v.length;w+=1)f.delete(v[w]);x(a,A.prev,M.next),x(a,o,A),x(a,M,E),s=E,o=M,y-=1,c=[],v=[]}else f.delete(m),$(m,s,i),x(a,m.prev,m.next),x(a,m,o===null?a.first:o.next),x(a,o,m),o=m;continue}for(c=[],v=[];s!==null&&s.k!==T;)(s.e.f&R)===0&&(f??=new Set).add(s),v.push(s),s=s.next;if(s===null)continue;m=s}c.push(m),o=m,s=m.next}if(s!==null||f!==void 0){for(var F=f===void 0?[]:Z(f);s!==null;)(s.e.f&R)===0&&F.push(s),s=s.next;var re=F.length;if(re>0){var te=u===0?i:null;qe(a,F,te)}}t.first=a.first&&a.first.e,t.last=o&&o.e;for(var se of r.values())j(se.e);r.clear()}function ae(t,e,a,r){ge(t.v,e),t.i=a}function k(t,e,a,r,i,l,n,d,g,u,p){var h=(g&we)!==0,s=(g&Te)===0,f=h?s?K(i,!1,!1):X(i):i,o=(g&Ne)===0?n:X(n),c={i:o,v:f,k:l,a:null,e:null,prev:a,next:r};try{if(t===null){var v=document.createDocumentFragment();v.append(t=J())}return c.e=G(()=>d(t,f,o,u),D),c.e.prev=a&&a.e,c.e.next=r&&r.e,a===null?p||(e.first=c):(a.next=c,a.e.next=c.e),r!==null&&(r.prev=c,r.e.prev=c.e),c}finally{}}function $(t,e,a){for(var r=t.next?t.next.e.nodes_start:a,i=e?e.e.nodes_start:a,l=t.e.nodes_start;l!==null&&l!==r;){var n=be(l);i.before(l),l=n}}function x(t,e,a){e===null?t.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}var $e=De('<circle r="4" class="svelte-1vrm2o4"></circle><text y="115" font-size="10" text-anchor="middle"> </text>',1),Ge=V('<div class="bg-white rounded shadow p-4 svelte-1vrm2o4"><h3 class="font-bold mb-2">Chronos des tours</h3> <svg width="100%" height="120" viewBox="0 0 4000 120"></svg></div>');function Ke(t,e){let a=Oe(e,"laps",24,()=>[]);var r=Ge(),i=Y(U(r),2);Re(i,5,a,Pe,(l,n,d)=>{var g=$e(),u=ee(g);H(u,"cx",20+d*30);var p=Y(u);H(p,"x",20+d*30);var h=U(p,!0);O(p),Ae(s=>{H(u,"cy",s),H(u,"fill",(N(n),B(()=>N(n).lapType==="g"?"#38bdf8":N(n).lapType==="p"?"#f59e42":N(n).lapType==="b"?"#ef4444":"#888"))),ne(h,(N(n),B(()=>N(n).lapNum)))},[()=>(N(n),B(()=>100-Math.min(+N(n).lapTime/1e3,90)))]),S(l,g)}),O(i),O(r),S(t,r)}function Ue(t){const e=t.match(/^D(\d+)\.L(\d+)#\|\|\|([bgp]?)(\d+)$/i);if(e){const a=e[1],r=e[2],i=e[3]||void 0,l=e[4];return{type:"L",teamId:a,lapNum:r,lapType:i,lapTime:l,flags:{pitStop:i==="b",bestTeamLap:i==="g",bestGlobalLap:i==="p"}}}return{type:"L",raw:t}}function ke(t){const e=t.match(/^D(\d+)\.P(\d+)#(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)$/);return e?{type:"P",teamId:e[1],lineNum:e[2],pitNum:e[3],lapNum:e[4],raceTimeBefore:e[5],raceTimeAfter:e[6],pitDuration:e[7],driverDuration:e[8],nbLapSinceLast:e[9],idDriver:e[10],totalDriverDuration:e[11]}:{type:"P",raw:t}}function Ve(t){const e=t.match(/^D(\d+)\.INF#(.*)$/s);if(!e)return{type:"INF",raw:t};const a=e[1],r=e[2].trim();try{const n=new DOMParser().parseFromString(r,"application/xml").querySelector("driver"),d=n?.getAttribute("name")??"",g=n?.querySelector("inf")?.getAttribute("value")??"",u=Array.from(n?.querySelectorAll(":scope > driver")??[]).map(p=>({id:p.getAttribute("id")??"",name:p.getAttribute("name")??""}));return{type:"INF",teamId:a,teamName:d,category:g,pilots:u}}catch{return{type:"INF",teamId:a,raw:r}}}async function We(t){const e=await fetch(`/data/laps/${t}`);if(!e.ok)throw new Error("Fichier non trouvé");return(await e.text()).split(`
`).filter(r=>r.trim().length>0).map(r=>{const i=r.match(/^D\d+\.(L|P|INF)/),l=i?i[1]:"UNKNOWN";return l==="L"?Ue(r):l==="P"?ke(r):l==="INF"?Ve(r):{type:"UNKNOWN",raw:r}})}var Xe=V("<div>Chargement…</div>"),Ye=V('<div class="grid md:grid-cols-2 gap-4"><!></div>');function ta(t,e){Me(e,!1);let a=K([]),r=[],i=K(!0);async function l(){r=await(await fetch("/data/laps/laps_files.json")).json(),r.length>0&&await n(r[0]),z(i,!1)}async function n(h){const s=await We(h);z(a,s.filter(f=>f.type==="L").map(f=>({lapNum:f.lapNum,lapTime:f.lapTime,lapType:f.lapType})).sort((f,o)=>Number(f.lapNum)-Number(o.lapNum)))}ie(l),He();var d=Fe(),g=ee(d);{var u=h=>{var s=Xe();S(h,s)},p=h=>{var s=Ye(),f=U(s);Ke(f,{get laps(){return N(a)}}),O(s),S(h,s)};Se(g,h=>{N(i)?h(u):h(p,!1)})}S(t,d),Ce()}export{ta as component};
