import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{s as ne,o as ie}from"../chunks/CnKsjyTb.js";import{s as O,h as D,a7 as le,f as J,c as oe,b as fe,w as N,B as ue,r as ce,H as ve,d as W,e as R,m as C,a8 as de,ac as pe,i as G,k as me,j as he,ag as Z,aq as _e,aA as K,aB as X,aC as ge,l as Q,p as ye,aD as Ne,aE as q,aF as j,aG as we,aH as Te,aa as be,aI as xe,af as Ie,aJ as Le,G as Ae,T as V,a0 as Y,X as U,$ as H,Z as S,aK as De,a4 as ee,_ as Ee,q as $,a3 as Me,aL as Fe,a5 as Ce,D as z}from"../chunks/Dg7XerDF.js";import{i as Se}from"../chunks/epf7fQTu.js";import{i as Pe}from"../chunks/COtTLUEp.js";import{s as P}from"../chunks/B0GOjEds.js";import{p as He}from"../chunks/BJDKmjST.js";import"../chunks/C-K_SV1I.js";function Oe(t,e){return e}function Re(t,e,a){for(var i=t.items,s=[],l=e.length,r=0;r<l;r++)xe(e[r].e,s,!0);var d=l>0&&s.length===0&&a!==null;if(d){var g=a.parentNode;Ie(g),g.append(a),i.clear(),x(t,e[0].prev,e[l-1].next)}Le(s,()=>{for(var u=0;u<l;u++){var p=e[u];d||(i.delete(p.k),x(t,p.prev,p.next)),j(p.e,!d)}})}function qe(t,e,a,i,s,l=null){var r=t,d={flags:e,items:new Map,first:null};{var g=t;r=D?O(le(g)):g.appendChild(J())}D&&oe();var u=null,p=!1,h=new Map,n=ue(()=>{var v=a();return _e(v)?v:v==null?[]:Z(v)}),o,f;function c(){$e(f,o,d,h,r,s,e,i,a),l!==null&&(o.length===0?u?Q(u):u=G(()=>l(r)):u!==null&&ye(u,()=>{u=null}))}fe(()=>{f??=Ae,o=N(n);var v=o.length;if(p&&v===0)return;p=v===0;let L=!1;if(D){var T=ce(r)===ve;T!==(v===0)&&(r=W(),O(r),R(!1),L=!0)}if(D){for(var m=null,y,_=0;_<v;_++){if(C.nodeType===de&&C.data===pe){r=C,L=!0,R(!1);break}var I=o[_],b=i(I,_);y=k(C,d,m,null,I,b,_,s,e,a),d.items.set(b,y),m=y}v>0&&O(W())}if(D)v===0&&l&&(u=G(()=>l(r)));else if(me()){var A=new Set,w=he;for(_=0;_<v;_+=1){I=o[_],b=i(I,_);var E=d.items.get(b)??h.get(b);E?ae(E,I,_):(y=k(null,d,null,null,I,b,_,s,e,a,!0),h.set(b,y)),A.add(b)}for(const[M,F]of d.items)A.has(M)||w.skipped_effects.add(F.e);w.add_callback(c)}else c();L&&R(!0),N(n)}),D&&(r=C)}function $e(t,e,a,i,s,l,r,d,g){var u=e.length,p=a.items,h=a.first,n=h,o,f=null,c=[],v=[],L,T,m,y;for(y=0;y<u;y+=1){if(L=e[y],T=d(L,y),m=p.get(T),m===void 0){var _=i.get(T);if(_!==void 0){i.delete(T),p.set(T,_);var I=f?f.next:n;x(a,f,_),x(a,_,I),B(_,I,s),f=_}else{var b=n?n.e.nodes_start:s;f=k(b,a,f,f===null?a.first:f.next,L,T,y,l,r,g)}p.set(T,f),c=[],v=[],n=f.next;continue}if(ae(m,L,y),(m.e.f&q)!==0&&Q(m.e),m!==n){if(o!==void 0&&o.has(m)){if(c.length<v.length){var A=v[0],w;f=A.prev;var E=c[0],M=c[c.length-1];for(w=0;w<c.length;w+=1)B(c[w],A,s);for(w=0;w<v.length;w+=1)o.delete(v[w]);x(a,E.prev,M.next),x(a,f,E),x(a,M,A),n=A,f=M,y-=1,c=[],v=[]}else o.delete(m),B(m,n,s),x(a,m.prev,m.next),x(a,m,f===null?a.first:f.next),x(a,f,m),f=m;continue}for(c=[],v=[];n!==null&&n.k!==T;)(n.e.f&q)===0&&(o??=new Set).add(n),v.push(n),n=n.next;if(n===null)continue;m=n}c.push(m),f=m,n=m.next}if(n!==null||o!==void 0){for(var F=o===void 0?[]:Z(o);n!==null;)(n.e.f&q)===0&&F.push(n),n=n.next;var re=F.length;if(re>0){var te=u===0?s:null;Re(a,F,te)}}t.first=a.first&&a.first.e,t.last=f&&f.e;for(var se of i.values())j(se.e);i.clear()}function ae(t,e,a,i){ge(t.v,e),t.i=a}function k(t,e,a,i,s,l,r,d,g,u,p){var h=(g&we)!==0,n=(g&Te)===0,o=h?n?K(s,!1,!1):X(s):s,f=(g&Ne)===0?r:X(r),c={i:f,v:o,k:l,a:null,e:null,prev:a,next:i};try{if(t===null){var v=document.createDocumentFragment();v.append(t=J())}return c.e=G(()=>d(t,o,f,u),D),c.e.prev=a&&a.e,c.e.next=i&&i.e,a===null?p||(e.first=c):(a.next=c,a.e.next=c.e),i!==null&&(i.prev=c,i.e.prev=c.e),c}finally{}}function B(t,e,a){for(var i=t.next?t.next.e.nodes_start:a,s=e?e.e.nodes_start:a,l=t.e.nodes_start;l!==null&&l!==i;){var r=be(l);s.before(l),l=r}}function x(t,e,a){e===null?t.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}var Be=De('<circle r="4" class="svelte-1vrm2o4"></circle><text y="115" font-size="10" text-anchor="middle"> </text>',1),Ge=V('<div class="bg-white rounded shadow p-4 svelte-1vrm2o4"><h3 class="font-bold mb-2">Chronos des tours</h3> <svg width="100%" height="120" viewBox="0 0 4000 120"></svg></div>');function Ke(t,e){let a=He(e,"laps",24,()=>[]);var i=Ge(),s=Y(U(i),2);qe(s,5,a,Oe,(l,r,d)=>{var g=Be(),u=ee(g);P(u,"cx",20+d*30);var p=Y(u);P(p,"x",20+d*30);var h=U(p,!0);H(p),Ee(n=>{P(u,"cy",n),P(u,"fill",(N(r),$(()=>N(r).lapType==="g"?"#38bdf8":N(r).lapType==="p"?"#f59e42":N(r).lapType==="b"?"#ef4444":"#888"))),ne(h,(N(r),$(()=>N(r).lapNum)))},[()=>(N(r),$(()=>100-Math.min(+N(r).lapTime/1e3,90)))]),S(l,g)}),H(s),H(i),S(t,i)}const Ue="/apex-timing-viewer/data/laps";function ke(t){const e=t.match(/^D(\d+)\.L(\d+)#\|\|\|([bgp]?)(\d+)$/i);if(console.log(`(${t})`),console.log(e),e){const a=e[1],i=e[2],s=e[3]||void 0,l=e[4];return{type:"L",teamId:a,lapNum:i,lapType:s,lapTime:l,flags:{pitStop:s==="b",bestTeamLap:s==="g",bestGlobalLap:s==="p"}}}return{type:"L",raw:t}}function Ve(t){const e=t.match(/^D(\d+)\.P(\d+)#(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)\|(\d+)$/);return e?{type:"P",teamId:e[1],lineNum:e[2],pitNum:e[3],lapNum:e[4],raceTimeBefore:e[5],raceTimeAfter:e[6],pitDuration:e[7],driverDuration:e[8],nbLapSinceLast:e[9],idDriver:e[10],totalDriverDuration:e[11]}:{type:"P",raw:t}}function We(t){const e=t.match(/^D(\d+)\.INF#(.*)$/s);if(!e)return{type:"INF",raw:t};const a=e[1],i=e[2].trim();try{const r=new DOMParser().parseFromString(i,"application/xml").querySelector("driver"),d=r?.getAttribute("name")??"",g=r?.querySelector("inf")?.getAttribute("value")??"",u=Array.from(r?.querySelectorAll(":scope > driver")??[]).map(p=>({id:p.getAttribute("id")??"",name:p.getAttribute("name")??""}));return{type:"INF",teamId:a,teamName:d,category:g,pilots:u}}catch{return{type:"INF",teamId:a,raw:i}}}async function Xe(t){const e=`${Ue}/${t}`,a=await fetch(e);if(!a.ok)throw new Error("Fichier non trouvé");return(await a.text()).split(`
`).filter(s=>s.trim().length>0).map(s=>{const l=s.match(/^D\d+\.(L|P|INF)/),r=l?l[1]:"UNKNOWN";return r==="L"?ke(s):r==="P"?Ve(s):r==="INF"?We(s):{type:"UNKNOWN",raw:s}})}var Ye=V("<div>Chargement…</div>"),ze=V('<div class="grid md:grid-cols-2 gap-4"><!></div>');function na(t,e){Me(e,!1);let a=K([]),i=[],s=K(!0);async function l(){i=await(await fetch("/data/laps/laps_files.json")).json(),i.length>0&&await r(i[0]),z(s,!1)}async function r(h){const n=await Xe(h);z(a,n.filter(o=>o.type==="L").map(o=>({lapNum:o.lapNum,lapTime:o.lapTime,lapType:o.lapType})).sort((o,f)=>Number(o.lapNum)-Number(f.lapNum))),console.log(h,N(a))}ie(l),Pe();var d=Fe(),g=ee(d);{var u=h=>{var n=Ye();S(h,n)},p=h=>{var n=ze(),o=U(n);Ke(o,{get laps(){return N(a)}}),H(n),S(h,n)};Se(g,h=>{N(s)?h(u):h(p,!1)})}S(t,d),Ce()}export{na as component};
